<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference Docs | Linguistic Processing API</title>
    <style>
        :root { --p: #0066FF; --bg: #ffffff; --t: #171717; --a: #F5F5F7; }
        * { box-sizing: border-box; transition: 0.2s; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
        #doc-root { display: flex; flex-direction: column; min-height: 100vh; }
        nav { border-bottom: 1px solid #eee; padding: 12px 40px; display: flex; justify-content: space-between; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); }
        .hero { padding: 60px 40px; max-width: 800px; margin: 0 auto; }
        .search-box { margin-top: 30px; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: var(--a); }
        .btn { background: var(--p); color: #fff; border: none; padding: 0 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* 裏：ゲーム画面（枠線とグリッドを強化） */
        #data-view { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .g-header { width: 404px; display: flex; justify-content: space-between; color: #fff; margin-bottom: 10px; font-family: monospace; }
        #canvas-wrap { 
            position: relative; 
            border: 4px solid var(--p); /* 視認性のための太い青枠 */
            border-radius: 8px; 
            box-shadow: 0 0 20px rgba(0,102,255,0.5); 
        }
        canvas { background: #000; display: block; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .card { background: #111; border: 1px solid #333; padding: 12px; border-radius: 10px; cursor: pointer; width: 160px; }
        .card:hover { background: var(--p); }
        .card h5 { margin: 0; color: #00ffcc; }
    </style>
</head>
<body>

    <div id="doc-root">
        <nav><div style="font-weight:bold;">L-PROCESSING API</div></nav>
        <div class="hero">
            <h1>API Documentation</h1>
            <div class="search-box">
                <input type="text" id="token" placeholder="Authentication Token...">
                <button class="btn" onclick="verify()">Authenticate</button>
            </div>
            <p style="margin-top:20px; font-size:14px; color:#666;">認証トークンを入力してリソースにアクセスしてください。</p>
        </div>
    </div>

    <div id="data-view">
        <div class="g-header">
            <div>MODE: LEVEL-<span id="lv-num">0</span></div>
            <div>SCORE: <span id="s-out">0</span></div>
        </div>
        <div id="canvas-wrap">
            <canvas id="c" width="400" height="400"></canvas>
            <div id="m" class="overlay">
                <h3 id="mt">SELECT DATASET</h3>
                <div class="grid">
                    <div class="card" onclick="run(140,1)"><h5>Lv.1 Easy</h5><small id="b1">Best: 0</small></div>
                    <div class="card" onclick="run(100,2)"><h5>Lv.2 Normal</h5><small id="b2">Best: 0</small></div>
                    <div class="card" onclick="run(75,3)"><h5>Lv.3 Hard</h5><small id="b3">Best: 0</small></div>
                    <div class="card" onclick="run(45,4)"><h5>Lv.4 Master</h5><small id="b4">Best: 0</small></div>
                </div>
                <p style="font-size:10px; color:#444; margin-top:15px;">ESC to Exit</p>
            </div>
        </div>
    </div>

    <script>
        const cv = document.getElementById('c'), x = cv.getContext('2d');
        let nd, fd, d, sc, l, q, lv;

        function verify() {
            if (document.getElementById('token').value === 'snake.run') {
                document.getElementById('doc-root').style.display = 'none';
                document.getElementById('data-view').style.display = 'flex';
                updateScores();
            }
        }

        function updateScores() {
            for(let i=1; i<=4; i++) {
                document.getElementById(`b${i}`).innerText = "Best: " + (localStorage.getItem(`snake_v5_hi_${i}`) || 0);
            }
        }

        function run(s, v) {
            lv = v; document.getElementById('lv-num').innerText = v;
            nd = [{x:10, y:10}, {x:9, y:10}]; fd = spawn(); d = 'R'; q = []; sc = 0;
            document.getElementById('s-out').innerText = "0";
            document.getElementById('m').style.display = 'none';
            if (l) clearInterval(l);
            l = setInterval(upd, s);
        }

        function spawn() { return { x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20) }; }

        function upd() {
            if (q.length > 0) {
                const n = q.shift();
                if (n==='U'&&d!=='D') d='U'; if (n==='D'&&d!=='U') d='D';
                if (n==='L'&&d!=='R') d='L'; if (n==='R'&&d!=='L') d='R';
            }
            let h = { ...nd[0] };
            if (d==='U') h.y--; if (d==='D') h.y++; if (d==='L') h.x--; if (d==='R') h.x++;
            if (h.x<0 || h.x>=20 || h.y<0 || h.y>=20 || nd.some(s=>s.x===h.x && s.y===h.y)) return end();
            nd.unshift(h);
            if (h.x===fd.x && h.y===fd.y) {
                sc += 10; document.getElementById('s-out').innerText = sc;
                fd = spawn();
            } else { nd.pop(); }
            draw();
        }

        function draw() {
            // 背景とグリッド
            x.fillStyle="#000"; x.fillRect(0,0,400,400);
            x.strokeStyle="#111"; // グリッド線
            for(let i=0; i<20; i++) {
                x.strokeRect(i*20, 0, 1, 400);
                x.strokeRect(0, i*20, 400, 1);
            }
            // 餌
            x.shadowBlur=15; x.shadowColor="#f33"; x.fillStyle="#f33";
            x.beginPath(); x.arc(fd.x*20+10, fd.y*20+10, 8, 0, 7); x.fill();
            // 蛇
            nd.forEach((s,i)=>{
                x.shadowBlur=i==0?15:0; x.shadowColor="#06f";
                x.fillStyle=i==0?"#fff":"#06f";
                x.fillRect(s.x*20+1, s.y*20+1, 18, 18);
            });
            x.shadowBlur=0;
        }

        function end() {
            clearInterval(l);
            const key = `snake_v5_hi_${lv}`;
            const hi = localStorage.getItem(key) || 0;
            if (sc > hi) localStorage.setItem(key, sc);
            document.getElementById('mt').innerText = "FATAL ERROR / SCORE: " + sc;
            document.getElementById('m').style.display = 'flex';
            updateScores();
        }

        window.addEventListener('keydown', e => {
            if (e.key==='ArrowUp') q.push('U'); if (e.key==='ArrowDown') q.push('D');
            if (e.key==='ArrowLeft') q.push('L'); if (e.key==='ArrowRight') q.push('R');
            if (e.key==='Escape') location.reload();
            if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
        });
    </script>
</body>
</html>
